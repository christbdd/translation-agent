# 翻译代理：使用反思工作流程的代理翻译

这是一个Python展示的机器翻译的反思性代理工作流程。主要步骤是：
1. 提示一个大语言模型将文本从【源语言】翻译到【目标语言】；
2. 让大语言模型反思翻译过程，提出改进的建设性建议；
3. 使用这些建议来改进翻译。

## 可定制性 

使用大语言模型作为翻译引擎的核心，该系统具有高度的可操控性。例如，通过改变提示，使用这种工作流程比传统的机器翻译（MT）系统更容易实现以下目标：
- 修改输出的风格，如正式/非正式。
- 指定如何处理成语和特殊术语，如姓名、技术术语和缩写。例如，在提示中包含词汇表可以确保特定术语（如开源、H100或GPU）的翻译保持一致性。
- 指定特定地区的语言使用或特定方言，以服务于目标受众。例如，拉丁美洲的西班牙语与西班牙的西班牙语不同；加拿大的法语与法国的法语不同。

**这不是成熟的软件**，而是**吴恩达**在过去几个月的周末玩弄翻译的结果，加上合作者（Joaquin Dominguez、Nedelina Teneva、John Santerre）帮助重构代码。

根据我们使用传统翻译数据集上的BLEU分数进行的评估，这种工作流程有时与领先的商业产品竞争，但有时也不如它们。然而，我们也偶尔得到了极好的结果（优于商业产品），采用这种方法。我们认为这只是代理翻译的起点，并且这是一个有希望的翻译方向，有很大的改进空间，这就是为什么我们发布这个演示，以鼓励更多的讨论、实验、研究和开源贡献。

如果Agent翻译能够比传统架构（例如端到端的Transformer，它直接输入文本并输出翻译）产生更好的结果——这些架构通常运行速度更快/成本更低——这也提供了一种机制，可以自动生成训练数据（平行文本语料库），这些数据可以用于进一步训练和改进传统算法。（另见[这篇文章在The Batch](https://www.deeplearning.ai/the-batch/building-models-that-learn-from-themselves/)，关于使用大语言模型生成训练数据的内容。）

非常欢迎对如何改进这一点提出评论和建议！


## 开始使用

要开始使用 `translation-agent`，请按照以下步骤操作：

### 安装：
- 安装需要 Poetry 包管理器。[Poetry 安装](https://python-poetry.org/docs/#installation) 根据您的环境，以下命令可能有效：

```bash
pip install poetry 
```

- 需要一个包含 OPENAI_API_KEY 的 .env 文件来运行工作流。请参阅 .env.sample 文件作为示例。
```bash
git clone https://github.com/andrewyng/translation-agent.git 
cd translation-agent
poetry install
poetry shell # 激活虚拟环境
```

### 使用方法：

```python
import translation_agent as ta
source_lang, target_lang, country = "English", "Spanish", "Mexico"
translation = ta.translate(source_lang, target_lang, source_text, country)
```
请参阅 examples/example_script.py 中的示例脚本进行尝试。

## 许可证

Translation Agent 根据 **MIT 许可证** 发布。您可以自由使用、修改和分发代码，无论是商业用途还是非商业用途。

## 扩展想法

以下是我们没有时间尝试，但希望开源社区能够实现的一些想法：
- **尝试其他大型语言模型（LLMs）。** 我们主要使用gpt-4-turbo进行原型设计。我们希望其他人也能尝试使用其他大型语言模型以及其他超参数选择，并看看是否有一些模型在特定语言对的翻译上表现得更好。
- **术语表创建。** 如何高效地构建一个术语表——可能使用大型语言模型——包含我们希望一致翻译的最重要术语？例如，许多企业使用在互联网上不常见的专业术语，因此大型语言模型可能不了解这些术语，同时也有很多术语可以有多种翻译方式。例如，“开源”在西班牙语中可以是“Código abierto”或“Fuente abierta”；两种都可以接受，但最好选择一种并在单个文档中坚持使用。
- **术语表的使用和实现。** 有了术语表之后，如何最好地将其包含在提示中？
- **不同语言的评估。** 它在不同语言中的性能如何变化？是否有一些变化使其对特定的源语言或目标语言更有效？（请注意，对于机器翻译系统正在接近的非常高的性能水平，我们不确定BLEU是否是一个好指标。）此外，它对资源较少的语言的性能还需要进一步研究。
- **错误分析。** 我们发现指定一种语言和一个国家/地区（例如，“在墨西哥日常口语中的西班牙语”）对我们的应用来说效果相当不错。当前方法在哪里不足？我们还特别有兴趣了解其在专业主题（如法律、医学）或特殊文本类型（如电影字幕）上的性能，以了解其局限性。
- **更好的评估。** 最后，我们认为更好的评估是一个巨大且重要的研究课题。与其他生成自由文本的大型语言模型应用一样，当前的评估指标似乎不够充分。例如，我们发现即使在文档中我们的代理工作流程更好地捕捉了上下文和术语，从而产生了我们人类评估者更倾向于选择的翻译，但在句子级别（使用[FLORES](https://github.com/facebookresearch/flores) 数据集）的评估中，代理系统在BLEU上的得分却更低。我们能否设计更好的指标（也许使用大型语言模型来评估翻译？）来捕捉与人类偏好更相关的文档级别的翻译质量？


## 相关工作

一些学术研究小组也开始关注基于大型语言模型（LLM）和代理翻译。我们认为这个领域还处于初期阶段！
- **《ChatGPT机器翻译：对高资源（而非低资源）语言的竞争性》**，Robinson等人（2023年），[链接](https://arxiv.org/pdf/2309.07423)
- **《如何为ChatGPT设计翻译提示：一项实证研究》**，Gao等人（2023年），[链接](https://arxiv.org/pdf/2304.02182v2)
- **《超越人类翻译：利用多代理协作翻译超长文学作品》**，Wu等人（2024年），[链接](https://arxiv.org/pdf/2405.11804)

